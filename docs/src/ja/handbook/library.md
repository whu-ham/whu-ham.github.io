# 図書館
Hamを使って図書館の座席予約を簡単に行えます。

::: tip 注意
新バージョンではキャプチャ認識が削除されています。新しいHamをご利用の場合は、以下の「キャプチャ認識」に関する記述を無視してください。
:::

## 準備
図書館機能を使う前に以下が必要です：
- 図書館アカウント / 情報ポータルアカウント
- ~~Tencent Cloud OCR~~

### 図書館アカウント / 情報ポータルアカウントの準備
通常、学期開始後の数週間以内に図書館アカウントが設定されています。デフォルトのパスワードは身分証の下6桁です。忘れた場合は図書館窓口で手続きしてください。

~~### Tencent Cloud OCRアカウントの準備~~
~~図書館座席予約の提供元がキャプチャを導入したため、Hamは自動認識に対応しました。~~

キャプチャ認識にはTencent Cloud OCRを使用します。認証のため、図書館機能を使う前に**必ず**Tencent Cloud OCRの情報を入力してください。ユーザーごとに月1000回の無料枠があります。予約を悪用しなければ十分な回数です。

::: warning 注意
HamはTencent Cloudアカウントを含むあなたの情報を取得しません。Hamは複数の設計で機密データを保護していますが、ご自身でもアカウントを守る責任があります。
:::

#### Tencent Cloud OCRの有効化方法
以下のリンクをご参照ください。

[腾讯云OCRの有効化](https://cloud.tencent.com/document/product/866/17622)

[Secret IDとSecret Keyの取得](https://console.cloud.tencent.com/cam/capi)

::: danger 重要
Tencent Cloud OCRを初めて使う場合、**必ず**コンソールで情報を入力してサービスを有効化してください。

情報を入力していない場合は有効化できておらず、OCRは利用できません。
:::

## 座席マップ予約
図書館・部屋・座席ごとの空き状況を見て直接予約できます。

座席マップ予約に向くケース：
- 今日は図書館に行きたいが予約がない
- 部屋や座席にこだわりがない

座席マップ予約は図書館機能の最初のタブ（旧バージョンでは「予約」）です。

::: tip 注意
座席を選択した後に他の学生が予約した場合、Hamは近くの座席を自動で選びません。
:::

## クイック予約
お気に入りの座席を保存して、すぐに予約できます。

クイック予約が便利なケース：
- 図書館によく行き、固定の席がある
- 自動化予約を使いたい
- すぐに図書館へ行きたいが特定の部屋に座りたい

Hamで予約したことがある、または「優先座席」を設定していると、図書館トップにクイック予約タブが表示されます。座席や時間をタップして一時的に変更することも可能です。

::: tip 注意
クイック予約は「優先座席」の設定にできる限り合わせます。予約に失敗した場合、Hamが近くの席をすぐに選びます。
:::

## 優先座席
クイック予約で使われるデフォルトの座席です。

予約時間・座席・好みを事前に設定できます。図書館ページを開くたびに、クイック予約がこの設定を使用します。

優先座席は「図書館設定」で変更できます。

## 予約ステータス
有効な予約がある場合、図書館ホームとステータスページに表示されます。

ステータスから予約時間の変更やキャンセルが可能です。

長時間予約で途中退出が必要な場合（図書館の制限を超えるとき）、退出前に予約時間を変更して戻ってきた際も同じ席に座れるようにできます。

予約ステータスを取得すると、iOSカレンダーに自動で追加され、入館10分前に通知します。

予約ステータスはLiveActivityに対応し、「予約済み」の状態が通知領域に固定表示されます（iOS）。

## 履歴
図書館の予約履歴を確認できます。

## ウィジェット
ウィジェットをホーム画面に置き、予約場所や時間、退席中の時間を確認できます。

更新間隔を短くしすぎると、図書館側で一時的な利用停止になる可能性があります（目安は15分）。

## その他の図書館設定
~~### キャプチャ予約を使う~~
~~Hamはキャプチャ認識に時間がかかります。キャプチャ不要の予約でこの機能を使うと、枠と時間が無駄になります。~~

~~キャプチャが必要かどうかは図書館ミニアプリに従ってください。~~

新バージョンではキャプチャ予約はデフォルトで無効です。

### 基本データの更新
通常、予約ページに入るとHamはローカルの図書館データを使用し、通信を減らして速度を上げます。「図書館」に入るたびに基本データの更新を試みます。

- 図書館システムから更新

このオプションでは端末上で図書館システムにログインし、基本データを取得します。

### リセット
図書館機能に異常がある場合は「リセット」を押してください。

### 自動化（Android）
Hamで優先座席を設定し、「マイ」->「自動化」で自動化を有効にします。設定した時間に優先座席を予約します。システム時刻に基づき、翌日の予約かどうかを判断します。

### 自動化（iOS）
Hamで優先座席を設定し、ショートカットの「オートメーション」で個人用オートメーションを作成します。特定時刻を選び、「操作を追加」->「App」->「Ham」->「図書館クイック予約」を追加し、「実行前に尋ねる」をオフにします。設定した時間に優先座席を予約します。システム時刻に基づき、翌日の予約かどうかを判断します。

### ダイナミックアイランド / LiveActivity
条件を満たす予約は適切なタイミングで表示されます。

## 必要な権限
### 自動化
- Android: 自動起動
### ウィジェット
- Android: 自動起動
